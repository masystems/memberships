{% load static %}

<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'assets/images/favicon.png' %}">
    <script src="https://kit.fontawesome.com/e1cfa067bf.js" crossorigin="anonymous"></script>
    <title>Memberships</title>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.css' %}">
    <link href="{% static 'assets/extra-libs/toastr/dist/build/toastr.min.css' %}" rel="stylesheet">
    <link href="{% static 'dist/css/style.min.css' %}" rel="stylesheet">

    <script src="{% static 'assets/libs/jquery/dist/jquery.min.js' %}"></script>

    {% block header %}

    {% endblock %}

    {% include 'css.html' %}

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>
    <!-- Spinner Overlay -->
    <div id="donation-overlay-spinner" class="modal fade" data-backdrop="static" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content modal-filled bg-info">
                <div class="modal-body p-4">
                    <div class="text-center">
                        <div id="spinner">
                            <div class="spinner-border" role="status"></div>
                                <h3 class="text-white mt-2">Processing donation...</h3>
                            </div>
                    </div>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <!-- ============================================================== -->
    <!-- Preloader - style you can find in spinners.css -->
    <!-- ============================================================== -->
    <div class="preloader">
        <div class="lds-ripple">
            <div class="lds-pos"></div>
            <div class="lds-pos"></div>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- Main wrapper - style you can find in pages.scss -->
    <!-- ============================================================== -->
    <div id="main-wrapper">
        <!-- ============================================================== -->
        <!-- Topbar header - style you can find in pages.scss -->
        <!-- ============================================================== -->
        <header class="topbar">
            <nav class="navbar top-navbar navbar-expand-md navbar-dark">
                <div class="navbar-header">
                    <!-- This is for the sidebar toggle which is visible on mobile only -->
                    <a class="nav-toggler waves-effect waves-light d-block d-md-none" href="javascript:void(0)"><i class="ti-menu ti-close"></i></a>
                    <!-- ============================================================== -->
                    <!-- Logo -->
                    <!-- assets/images/cloud-lines-logo-teal-transparent.png -->
                    <!-- ============================================================== -->
                    <a class="navbar-brand" href="/">
                        <!-- Logo icon -->
                        <b class="logo-icon">
                            <!--You can put here icon as well // <i class="wi wi-sunset"></i> //-->
                            <!-- Dark Logo icon -->
                            <i class="fad fa-clouds dark-logo text-success"></i>
                            <!-- Light Logo icon -->
                            <i class="fad fa-clouds fa-2x text-white light-logo text-success"></i>
                        </b>
                        <!--End Logo icon -->
                    </a>
                    <!-- ============================================================== -->
                    <!-- End Logo -->
                    <!-- ============================================================== -->
                    <!-- ============================================================== -->
                    <!-- Toggle which is visible on mobile only -->
                    <!-- ============================================================== -->
                    <a class="topbartoggler d-block d-md-none waves-effect waves-light" href="javascript:void(0)" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><i class="ti-more"></i></a>
                </div>
                <!-- ============================================================== -->
                <!-- End Logo -->
                <!-- ============================================================== -->
                <div class="navbar-collapse collapse" id="navbarSupportedContent">
                    <!-- ============================================================== -->
                    <!-- toggle and nav items -->
                    <!-- ============================================================== -->
                    <ul class="navbar-nav float-left mr-auto">
                        <li class="nav-item d-none d-md-block"><a class="nav-link sidebartoggler waves-effect waves-light" href="javascript:void(0)" data-sidebartype="mini-sidebar"><i class="icon-arrow-left-circle"></i></a></li>
                        <!-- ============================================================== -->
                        <!-- Comment -->
                        <!-- ============================================================== -->
<!--                        <li class="nav-item dropdown">-->
<!--                            <a class="nav-link dropdown-toggle waves-effect waves-dark" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="mdi mdi-message"></i>-->
<!--                                 <div class="notify"> <span class="heartbit"></span> <span class="point"></span> </div>-->
<!--                            </a>-->
<!--                            <div class="dropdown-menu mailbox animated bounceInDown">-->
<!--                                <ul class="list-style-none">-->
<!--                                    <li>-->
<!--                                        <div class="font-weight-medium border-bottom rounded-top py-3 px-4">-->
<!--                                            Notifications-->
<!--                                        </div>-->
<!--                                    </li>-->
<!--                                    <li>-->
<!--                                        <div class="message-center notifications position-relative" style="height:250px;">-->
<!--                                            &lt;!&ndash; Message &ndash;&gt;-->
<!--                                            <a href="javascript:void(0)" class="message-item d-flex align-items-center border-bottom px-3 py-2">-->
<!--                                                <span class="btn btn-danger rounded-circle btn-circle"><i class="fa fa-link"></i></span>-->
<!--                                                <div class="w-75 d-inline-block v-middle pl-2">-->
<!--                                                    <h5 class="message-title mb-0 mt-1">Luanch Admin</h5> <span class="font-12 text-nowrap d-block text-muted text-truncate">Just see the my new admin!</span> <span class="font-12 text-nowrap d-block text-muted">9:30 AM</span> </div>-->
<!--                                            </a>-->
<!--                                            &lt;!&ndash; Message &ndash;&gt;-->
<!--                                            <a href="javascript:void(0)" class="message-item d-flex align-items-center border-bottom px-3 py-2">-->
<!--                                                <span class="btn btn-success rounded-circle btn-circle"><i class="ti-calendar"></i></span>-->
<!--                                                <div class="w-75 d-inline-block v-middle pl-2">-->
<!--                                                    <h5 class="message-title mb-0 mt-1">Event today</h5> <span class="font-12 text-nowrap d-block text-muted text-truncate">Just a reminder that you have event</span> <span class="font-12 text-nowrap d-block text-muted">9:10 AM</span> </div>-->
<!--                                            </a>-->
<!--                                            &lt;!&ndash; Message &ndash;&gt;-->
<!--                                            <a href="javascript:void(0)" class="message-item d-flex align-items-center border-bottom px-3 py-2">-->
<!--                                                <span class="btn btn-info rounded-circle btn-circle"><i class="ti-settings"></i></span>-->
<!--                                                <div class="w-75 d-inline-block v-middle pl-2">-->
<!--                                                    <h5 class="message-title mb-0 mt-1">Settings</h5> <span class="font-12 text-nowrap d-block text-muted text-truncate">You can customize this template as you want</span> <span class="font-12 text-nowrap d-block text-muted">9:08 AM</span> </div>-->
<!--                                            </a>-->
<!--                                            &lt;!&ndash; Message &ndash;&gt;-->
<!--                                            <a href="javascript:void(0)" class="message-item d-flex align-items-center border-bottom px-3 py-2">-->
<!--                                                <span class="btn btn-primary rounded-circle btn-circle"><i class="ti-user"></i></span>-->
<!--                                                <div class="w-75 d-inline-block v-middle pl-2">-->
<!--                                                    <h5 class="message-title mb-0 mt-1">Pavan kumar</h5> <span class="font-12 text-nowrap d-block text-muted text-truncate">Just see the my admin!</span> <span class="font-12 text-nowrap d-block text-muted">9:02 AM</span> </div>-->
<!--                                            </a>-->
<!--                                        </div>-->
<!--                                    </li>-->
<!--                                    <li>-->
<!--                                        <a class="nav-link border-top text-center text-dark pt-3" href="javascript:void(0);"> <strong>Check all notifications</strong> <i class="fa fa-angle-right"></i> </a>-->
<!--                                    </li>-->
<!--                                </ul>-->
<!--                            </div>-->
<!--                        </li>-->
<!--                        &lt;!&ndash; ============================================================== &ndash;&gt;-->
<!--                        &lt;!&ndash; End Comment &ndash;&gt;-->
<!--                        &lt;!&ndash; ============================================================== &ndash;&gt;-->
<!--                        &lt;!&ndash; ============================================================== &ndash;&gt;-->
<!--                        &lt;!&ndash; mega menu &ndash;&gt;-->
<!--                        &lt;!&ndash; ============================================================== &ndash;&gt;-->
                        <li class="nav-item dropdown mega-dropdown"><a class="nav-link dropdown-toggle waves-effect waves-dark" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class=""><button class="btn btn-primary"><i class="fad fa-envelope-open-dollar mr-2"></i>Donate to Organisation</button></span>
                            </a>
                        <form method="POST" action="{% url 'donation_payment' %}" id="donationForm">
                        {% csrf_token %}
                            <div class="dropdown-menu animated bounceInDown">
                                <div class="mega-dropdown-menu row">
                                    <form id="donationForm">
                                        <div class="col-lg-3 col-xlg-2 mb-4">
                                            <h4 class="mb-3">Donation Form</h4>
                                            <p>Donate to an organisation but filling out the below fields.</p>
                                            <div class="input-group">
                                                <div id="orgs">
                                                    <input class="typeahead1 form-control" type="text" id="organisation-donation" name="membership_package" placeholder="Type organisation name*">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-3  mb-4">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text bg-success text-white" id="basic-addon1">£</span>
                                                    </div>
                                                    <input id="donation-amount" class="form-control" type="text" name="amount" placeholder="Donation Amount*">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <input id="donator-full-name" type="text" class="form-control" name="full_name" value="{{ request.user.get_full_name }}">
                                            </div>
                                            <div class="form-group">
                                                <input id="donator-email" type="email" class="form-control" name="email_address" value="{{ request.user.email }}">
                                            </div>
                                            <div class="form-group">
                                                <textarea class="form-control" id="donator-message" rows="3" name="message" placeholder="Message"></textarea>
                                            </div>
                                        </div>
                                    </form>
                                    <div class="col-lg-3 col-xlg-4 mb-4 offset-lg-0">
                                        <form id="donation-payment-form">
                                            <label>Card Holders Name*:</label>
                                            <input id="cardholder-name" type="text" class="form-control" value="{{ request.user.get_full_name }}">
                                            <!-- placeholder for Elements -->
                                            <div id="donation-card-element"></div>
                                            <!-- Used to display Element errors. -->
                                            <div id="donation-card-errors" role="alert"></div>
                                            <div class="text-center mt-3" id="cardTypes" style="margin:0 auto;">
                                                <img src="{% static 'cloud-lines/images/cards/1.png' %}" alt="Card" style="max-height:32px">
                                                <img src="{% static 'cloud-lines/images/cards/2.png' %}" alt="Card" style="max-height:32px">
                                                <img src="{% static 'cloud-lines/images/cards/22.png' %}" alt="Card" style="max-height:32px">
                                            </div>
                                            <div class="card-body" id="donation-payment-buttons">
                                                <div class="form-group mb-0 text-right">
                                                    <button id="donation-button" class="btn btn-success waves-effect waves-light">Donate</button>
                                                </div>
                                            </div>
                                        </form>
                                        <div id="donationResult" class="d-none text-center">
                                            <h2>Success!</h2>
                                            <h6>Your donation was successful!</h6>
                                            <p>Your selected organisation has been notified of your kind donation.
                                            You should receive an email shortly confirming your donation.</p>

                                            <a href="#" target="_blank" id="donationReceipt"><button type="button" id="donationReceiptBtn" class="btn btn-dark mb-2">View Receipt</button></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                        </li>
                        <!-- ============================================================== -->
                        <!-- End mega menu -->
                        <!-- ============================================================== -->
                    </ul>
                    <!-- ============================================================== -->
                    <!-- Right side toggle and nav items -->
                    <!-- ============================================================== -->
                    <ul class="navbar-nav float-right">
                        <!-- ============================================================== -->
                        <!-- Search -->
                        <!-- ============================================================== -->
                        <li class=" d-none d-md-block">

                        </li>
                        <!-- ============================================================== -->
                        <!-- User profile and search -->
                        <!-- ============================================================== -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle text-white waves-effect waves-dark pro-pic" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{ request.user.get_full_name }}<i class="fad fa-user rounded-circle ml-2 text-dark"></i></a>
                            <div class="dropdown-menu dropdown-menu-right user-dd animated flipInY">
                                <div class="d-flex no-block align-items-center p-3 mb-2 border-bottom">
                                    <div class="u-img"><i class="fad fa-user-circle text-success fa-4x"></i></div>
                                    <div class="ml-2">
                                        <h4 class="mb-0">{{ request.user.get_full_name }}</h4>
                                        <p class=" mb-0">{{ request.user.email }}</p>
<!--                                        <a href="profile.html" class="btn btn-rounded btn-danger btn-sm">View Profile</a>-->
                                    </div>
                                </div>
                                <a class="dropdown-item" href="{% url 'member_profile' user.id %}#settings"><i class="ti-settings mr-1 ml-1"></i> Account Settings</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="{% url 'account_logout' %}"><i class="fa fa-power-off mr-1 ml-1"></i> Logout</a>
                            </div>
                        </li>
                        <!-- ============================================================== -->
                        <!-- User profile and search -->
                        <!-- ============================================================== -->

                    </ul>
                </div>
            </nav>
        </header>
        <!-- ============================================================== -->
        <!-- End Topbar header -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Left Sidebar - style you can find in sidebar.scss  -->
        <!-- ============================================================== -->
        <aside class="left-sidebar">
            <!-- Sidebar scroll-->
            <div class="scroll-sidebar">
                <!-- Sidebar navigation-->
                <nav class="sidebar-nav">
                    <ul id="sidebarnav">
                        <!-- User Profile-->
                        <li>
                            <!-- User profile -->
                            <div class="user-profile text-center position-relative pt-4 mt-1">
                                <!-- User profile image -->
                                <div class="m-auto"> <i class="fad fa-user-circle text-success fa-2x"></i> </div>
                                <!-- User profile text-->
                                <div class="profile-text py-1"> <span class="link u-dropdown text-info" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="true">{{ request.user.get_full_name }}</span>

                                </div>
                            </div>
                            <!-- End User profile text-->
                        </li>
                        <!-- User Profile-->
                        <li class="nav-small-cap"><i class="mdi mdi-dots-horizontal"></i> <span class="hide-menu">Membership Organisations</span></li>
<!--                        <li class="sidebar-item"> <a class="sidebar-link waves-effect waves-dark sidebar-link" href="/" aria-expanded="false"><i class="fad fa-home-alt mr-1"></i> <span class="hide-menu">Overview</span></a></li>-->
                        {% if membership_packages %}
                            {% for package in membership_packages.all %}
                                <li class="sidebar-item"> <a class="sidebar-link waves-effect waves-dark sidebar-link" href="{% url 'membership_package' package.organisation_name %}" aria-expanded="false"><i class="fad fa-globe mr-1"></i> <span class="hide-menu">
                                    {{ package.organisation_name }}
                                </span></a></li>
                            {% endfor %}
                        {% else %}
                            <li class="sidebar-item"> <a class="sidebar-link waves-effect waves-dark sidebar-link" href="{% url 'membership' %}" aria-expanded="false"><i class="fad fa-users mr-1"></i> <span class="hide-menu">
                                Create Organisation
                            </span></a></li>
                        {% endif %}

                        <li class="nav-devider"></li>
                        <li class="nav-small-cap"><i class="mdi mdi-dots-horizontal"></i> <span class="hide-menu">My Memberships</span></li>
                        <li class="sidebar-item"> <a class="sidebar-link waves-effect waves-dark sidebar-link" href="{% url 'member_profile' membership.id %}" aria-expanded="false"><i class="fad fa-user mr-1"></i><span class="hide-menu">
                            My Profile
                        </span></a></li>
                    </ul>
                </nav>
                <!-- End Sidebar navigation -->
            </div>
            <!-- End Sidebar scroll-->
            <!-- Bottom points-->
            <div class="sidebar-footer">
                <!-- item-->
                {% if request.user.is_superuser %}
                    <a href="/admin" target="_blank" class="link" data-toggle="tooltip" title="Settings"><i class="ti-settings"></i></a>
                {% endif %}
                <!-- item-->
<!--                <a href="" class="link" data-toggle="tooltip" title="Email"><i class="mdi mdi-gmail"></i></a>-->
                <!-- item-->
                <a href="{% url 'account_logout' %}" class="link" data-toggle="tooltip" title="Logout"><i class="mdi mdi-power"></i></a>
            </div>
            <!-- End Bottom points-->
        </aside>
        <!-- ============================================================== -->
        <!-- End Left Sidebar - style you can find in sidebar.scss  -->
        <!-- ============================================================== -->



        <!-- ============================================================== -->
        <!-- Page wrapper  -->
        <!-- ============================================================== -->
        <div class="page-wrapper">
            {% block content %}

            {% endblock %}
            <!-- ============================================================== -->
            <!-- footer -->
            <!-- ============================================================== -->
            <footer class="footer">
                   ©2020 Memberships by MA Systems Limited
            </footer>
            <!-- ============================================================== -->
            <!-- End footer -->
            <!-- ============================================================== -->
        </div>
        <!-- ============================================================== -->
        <!-- End Page wrapper  -->
        <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- End Wrapper -->
    <!-- ============================================================== -->

    <div class="chat-windows"></div>
    <!-- ============================================================== -->
    <!-- All Jquery -->
    <!-- ============================================================== -->

    <!-- Bootstrap tether Core JavaScript -->
    <script src="{% static 'assets/libs/popper.js/dist/umd/popper.min.js' %}"></script>
    <script src="{% static 'assets/libs/bootstrap/dist/js/bootstrap.min.js' %}"></script>
    <!-- apps -->
    <script src="{% static 'dist/js/app.min.js' %}"></script>
    <script src="{% static 'dist/js/app.init.mini-sidebar.js' %}"></script>
    <script src="{% static 'dist/js/app-style-switcher.js' %}"></script>
    <!-- slimscrollbar scrollbar JavaScript -->
    <script src="{% static 'assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js' %}"></script>
    <script src="{% static 'assets/libs/jquery-sparkline/jquery.sparkline.min.js' %}"></script>
    <!--Wave Effects -->
    <script src="{% static 'dist/js/waves.js' %}"></script>
    <!--Custom JavaScript -->
    <script src="{% static 'dist/js/feather.min.js' %}"></script>
    <script src="{% static 'dist/js/custom.min.js' %}"></script>
    <!-- Type Head JavaScript -->
    <script src="{% static 'assets/libs/typeahead.js/dist/typeahead.jquery.min.js' %}"></script>
    <script>
    var substringMatcher = function(strs) {
        return function findMatches(q, cb) {
            var matches, substringRegex;

            // an array that will be populated with substring matches
            matches = [];

            // regex used to determine if a string contains the substring `q`
            substrRegex = new RegExp(q, 'i');

            // iterate through the pool of strings and for any string that
            // contains the substring `q`, add it to the `matches` array
            $.each(strs, function(i, str) {
              if (substrRegex.test(str)) {
                matches.push(str);
              }
            });

            cb(matches);
              };
    };

    var orgs = [{% for org in all_packages.all %}
                        '{{ org.organisation_name }}',
                        {% endfor %}];
    $('#orgs .typeahead,#orgs .typeahead1').typeahead({
      hint: true,
      highlight: true,
      minLength: 0
    },
    {
      name: 'organisations',
      source: substringMatcher(orgs)
    });
    $('.typeahead, .typeahead1').bind('typeahead:active', function(ev, suggestion) {
        $('#organisations').attr("placeholder", "Type organisation name");
    });

    $('#joinOrg').click(function(e) {
        if (($('#organisations').val() != "") && (orgs.includes($('#organisations').val()))) {
            var url = "/membership/member-form/" + $('#organisations').val();
            window.location.href = url;
        }
    });
    </script>
    <!--Stripe JS -->
    <script src="https://js.stripe.com/v3/"></script>
    <script>

        function sleep (time) {
          return new Promise((resolve) => setTimeout(resolve, time));
        }

        $("#donation-button").click(function(e){
            e.preventDefault();
            // Define organisation checks
            var isOrganisation = $('#organisation-donation').val() != "";
            var organisationExists = orgs.includes($('#organisation-donation').val());

            // Define float checks
            var amount = $("#donation-amount").val();
            var floatRegex = /^\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*$/;
            var amountCheck = floatRegex.test(amount);

            // Define email checks
            var email = $("#donator-email").val();
            var emailRegex = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            var emailCheck = emailRegex.test(email);


            // Check organisation field
            if (isOrganisation && organisationExists && amountCheck && emailCheck) {
                $('#donation-overlay-spinner').modal();
                sleep(2000).then(() => {
                    submitDonationForm()
                });
            } else if (isOrganisation == false){
                errorMsg("Please fill the organisation name!");
            } else if (organisationExists == false){
                errorMsg("Oganisation does not exist!");
            }

            if(emailCheck == false){
               errorMsg("The Email is invalid!");
            }

            if(amountCheck == false){
               errorMsg("The amount is invalid!");
            }
        });

        function submitDonationForm() {
            // submit donation form
            // Get form
            var form = $('#donationForm')[0];

            // Create an FormData object
            var data = new FormData(form);

            $.ajax({
                url: '{% url 'donation_payment' %}',
                type: 'POST',
                processData: false,
                contentType: false,
                cache: false,
                dataType: 'text',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data: data,
                beforeSend: function() {
                },
                success: function(data) {
                    var result = JSON.parse(data);
                    if (result['status'] == "fail") {
                        $('#formError').removeClass('d-none');
                        $('#donation-overlay-spinner').modal('hide');
                    } else {
                        $('#formError').addClass('d-none');
                        generateCardToken(data);
                    }
                 },
                error: function(jqXHR, textStatus, errorThrown){
                    console.log('jqXHR:');
                    console.log(jqXHR);
                    console.log('textStatus:');
                    console.log(textStatus);
                    console.log('errorThrown:');
                    console.log(errorThrown);
                }
            });
        }

        // STRIPE STUFF
        var stripe = Stripe('{{ public_api_key }}');
        var elements = stripe.elements();

        // Custom styling can be passed to options when creating an Element.
        var style = {
          base: {
            color: '#32325d',
            fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
            fontSmoothing: 'antialiased',
            fontSize: '24px',
            '::placeholder': {
              color: '#aab7c4'
            }
          },
          invalid: {
            color: '#fa755a',
            iconColor: '#fa755a'
          }
        };

        // Create an instance of the card Element.
        var card = elements.create('card', {style: style});

        // Add an instance of the card Element into the `card-element` <div>.
        card.mount('#donation-card-element');


        card.addEventListener('change', function(event) {
          var displayError = document.getElementById('donation-card-errors');
          if (event.error) {
            displayError.textContent = event.error.message;
          } else {
            displayError.textContent = '';
          }
        });

        // Create a token or display an error when the form is submitted.
        function generateCardToken() {
            stripe.createToken(card).then(function(result) {
                if (result.error) {
                    // Inform the customer that there was an error.
                    var errorElement = document.getElementById('donation-card-errors');
                    errorElement.textContent = result.error.message;
                    $('#donation-overlay-spinner').modal('hide');
                } else {
                    // Send the token to your server.
                    donationStripeTokenHandler(result.token);
                }
            });
        }

        function donationStripeTokenHandler(token) {
            // Submit the token
            $.ajax({
                url: '{% url 'donation_payment' %}',
                type: 'POST',
                dataType: 'text',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data: {
                    'token': token,
                    },
                beforeSend: function() {
                    $('#paymentSuccess').addClass('d-none');
                    $('#paymentFail').addClass('d-none');
                },
                success: function(data) {
                    var result = JSON.parse(data);
                    if (result.result == 'fail') {
                        $('#donation-overlay-spinner').modal('hide');
                        $('#donation-card-errors').html(result.feedback);
                    } else {
                        $('#donation-payment-form').addClass('d-none');
                        $('#donation-payment-buttons').addClass('d-none');
                        loadSuccessPage(result);
                    }
                 },
                error: function(jqXHR, textStatus, errorThrown){
                    console.log('jqXHR:');
                    console.log(jqXHR);
                    console.log('textStatus:');
                    console.log(textStatus);
                    console.log('errorThrown:');
                    console.log(errorThrown);
                }
            });
        }

        function loadSuccessPage(result) {
            $('#donation-overlay-spinner').modal('hide');

            //update layout
            $('#donationResult').removeClass('d-none');
            $('#donationReceipt').attr("href", result.receipt);
        }
    </script>
    <!--Page Messages -->
    <script src="{% static 'assets/extra-libs/toastr/dist/build/toastr.min.js' %}"></script>
    <script>
        function infoMsg(msg) {
            toastr.info(msg, 'Information', { "progressBar": true });
        }

        function warningMsg(msg) {
            toastr.warning(msg, 'Warning', { "progressBar": true });
        }
        function errorMsg(msg) {
            toastr.error(msg, 'Error', { "progressBar": true });
        }

        {% if info_message %}
            toastr.info({{ info_message }}, 'Information', { "progressBar": true });
        {% endif %}

        {% if warning_message %}
            toastr.warning({{ warning_message }}, 'Warning', { "progressBar": true });
        {% endif %}

        {% if error_message %}
            toastr.error({{ error_message }}, 'Error', { "progressBar": true });
        {% endif %}

        $(document).ready(function(){
            // get the tab from url
            var hash = window.location.hash;

            // if a hash is present (when you come to this page)
            if (hash !='') {
                // show the tab
                $('a[href="' + hash + '"]').tab('show');
            }
        });
    </script>
    {% block footer %}
    {% endblock %}
</body>

</html>